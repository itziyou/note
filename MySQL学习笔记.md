[一、MySQL性能的主要因素](#MySQL性能的主要因素)<br>
[二、自然主键与代理主键](#自然主键与代理主键)





## MySQL性能的主要因素

1. 数据库结构设计

2. 数据库存储引擎
3. SQL语句的书写
4. 数据库参数配置
5. 服务器操作系统与硬件

## 数据库设计三范式

### 第一范式

1. 数据库所有字段都只有单一属性
2. 单一属性是有基本数据类型构成
3. 数据库的表都是二维的（行与列）

4. 每个字段都有独立的属性，不可拆分

### 第二范式

1. 要求符合第一范式
2. 必须含有一个主键
3. 其他字段由主键确定
4. 二范式的目的是通过拆表减少数据冗余

### 第三范式

1. 要求符合第二范式
2. 字段要求直接依赖于主键，不允许间接依赖
3. 第三范式目的在于拆分实体（完善主从表）

## 实体关系分析

### 实体关系的种类

1. 一对一
2. 一对多
3. 多对多

### 表关系设计原则

1. 一对一，通过主键关联
2. 一对多，在多的一方设置外键
3. 多对多，增加中间表，持有双方外键

## 自然主键与代理主键

1. 自然主键是指事物属性中的自然唯一标识
2. 代理主键是指与业务无关的，无意义的数字序列值
3. 在表设计时，优先推荐使用代理主键

## 数据类型的选择

### 字段类型优先级

1. 数据类型
2. 日期类型与二进制类型
3. 字符串类型

 ### VARCHAR类型

**VARCHAR变体长度，根据实际内容保存数据**

1. 使用最小的符合需求的长度
2. VARCHAR(255)以上使用额外一个字节保存长度
3. VARCHAR(255)以上使用额外两个字节保存长度
4. VARCHAR(5)与VARCHAR(200)内存占用不同
5. VARCHAR变更长度时会出现锁表

### VARCHAR使用场景

1. VARCHAR适合存储长度波动大的数据，（如博客文章）
2. 字符串很少被更新的场景
3. VARCHAR适合保存多字节字符

### CHAR类型

**CHAR属于定长数据**

1. CHAR最大长度255
2. CHAR类型会自动删除末尾的空格
3. CHAR检索效率要比VARCHAR高

### CHAR的使用场景

1. CHAR适合存储长度波动不大的数据，如MD5摘要
2. CHAR适合存储短字符串
3. CHAR类型适合存储经常更新的字符串

### DATETIME日期类型

**DATETME日期时间类型，占用8个字节**

1. 与时区无关
2. 可保存到毫秒
3. 可保存时间范围大

不要使用字符串存储日期类型

### TMESTAMP时间戳

**TIMESTAMP时间戳，占用四个字节**

1. 时间范围：1970-01-01到2038-01-19
2. 精确到秒
3. 采用整型存储
4. 依赖于时区
5. 自动更新timestamp列的值

## 反范式设计的优缺点

1. 单表查询易于优化，易于管理
2. SQL语句简单，有利于程序开发，团队协作
3. 存在数据冗余，写操作时需要额外更新从表数据
4. 不合理的反范式设计会让表变得臃肿

## MySQL存储引擎

存储引擎只针对表，数据库中允许出现不同的存储引擎

InnoDB、MySAM、Memory、CSV、XtraDB、Archive、Federated

### InnoDB存储引擎

1. MySQL 5.5.8后InnoDB是默认的存储引擎
2. InnoDB采用“表空间”保存文件
3. InnoDB支持事务处理

### InnoDB的存储特性

- InnoDB表空间有两种形式
  - 使用系统表空间ibdataN
  - 使用独立表空间：tablename.ibd（推荐）
- 设置innodb_file_pe_table决定表空间模式

5.5.8版本以后默认使用InnoDB作为存储引擎，之前是MyISAM

### 为什么推荐独立表空间

- 系统表空间 all in one 不利于管理
- 系统表空间会产生IO瓶颈
- 系统表空间很难回收存储空间
- 独立表空间使用optimize table命令回收存储空间

### InnoDB的事物特性

- InnoDB支持事务
- InnoDB默认使用行级锁
- InnoDB具备良好的高并发特性

#### MySQL的锁

**职责分类**

- ​	共享锁-读锁
- ​	独占锁（排它锁）-写锁

**粒度分类**

- ​	行级锁
- ​	表级锁

在InnoDB中只有利用索引的更新、删除操作，才可以使用行级锁。<br>

不能使用索引的写操作则是表锁

### InnoDB的使用场景

InnoDB存储引擎适用于绝大多数场景

MySQL 5.7以后InnoDB也支持全文所以与空间函数

5.5 版本以前默认是MyISAM